#!/usr/bin/ruby

# Tests for the Number "fermat_psp" method.

# Timings:
#   04 March 2023: 2.813s (with MPU)
#   04 March 2023: 3.690s (without MPU)

func T(n,k) {       # OEIS: A271873
    if (n < 2) {
        return []
    }

    var x = 1
    var y = 2*x

    loop {
        var v = k.fermat_psp(n,x,y)
        v.len >= 1 && return v[0]
        x = y+1
        y = 2*x
    }
}

assert_eq(
    {|x| {|y| T(x,y) }.map(2..6) }.map(2..6),
    [
        %n[341  561 11305   825265  45593065]
        %n[ 91  286 41041   825265 130027051]
        %n[ 15  435 11305   418285  30534805]
        %n[124  561 41041  2203201  68800501]
        %n[ 35 1105 25585   682465  12306385]
    ]
)

assert_eq(
    {|k|
        {|n|
            T(n, k - n + 2)
        }.map(2..k)
    }.map(2..14).flat,
    %n[341, 561, 91, 11305, 286, 15, 825265, 41041, 435, 124, 45593065, 825265, 11305, 561, 35, 370851481, 130027051, 418285, 41041, 1105, 6, 38504389105, 2531091745, 30534805, 2203201, 25585, 561, 21, 7550611589521, 38504389105, 370851481, 68800501, 682465, 62745, 105, 28, 277960972890601, 5342216661145, 38504389105, 979865601, 12306385, 902785, 1365, 286, 33, 32918038719446881, 929845918823185, 7550611589521, 232250619601, 305246305, 87570145, 121485, 2926, 561, 10, 1730865304568301265, 36116918534792305, 277960972890601, 9746347772161, 16648653385, 9073150801, 2103465, 421876, 41041, 70, 65, 606395069520916762801, 6748244949134115505, 32918038719446881, 1237707914764321, 1387198666945, 211215631705, 96537441, 5533066, 1242241, 1330, 385, 6, 59989606772480422038001, 144331068898382107105, 1730865304568301265, 21083752607078161, 75749848475665, 24465723528961, 3958035081, 85851766, 68800501, 668865, 5005, 105, 15]
)

say ":: Test passed!"
