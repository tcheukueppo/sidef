#!/usr/bin/ruby

# Tests for the Number "strong_fermat_psp" method.

# Timings:
#   05 March 2023: 1.617s (with MPU)
#   05 March 2023: 2.512s (without MPU)

func T(n,k) {       # OEIS: A271873
    if (n < 2) {
        return []
    }

    var x = 1
    var y = 2*x

    loop {
        var v = k.strong_fermat_psp(n,x,y)
        v.len >= 1 && return v[0]
        x = y+1
        y = 2*x
    }
}

assert_eq(
    {|x| {|y| T(x,y) }.map(2..6) }.map(2..6),
    [
        %n[2047, 15841,  800605, 293609485,  10761055201]
        %n[ 703,  8911,  152551,  41341321,  12283706701]
        %n[ 341,  4371,  129921,   9224391,   2592053871]
        %n[ 781, 24211, 4382191, 381347461,   9075517561]
        %n[ 217, 29341, 3405961, 557795161, 333515107081]
    ]
)

assert_eq(
    {|k|
        {|n|
            T(n, k - n + 2)
        }.map(2..k)
    }.map(2..10).flat,
    %n[2047, 15841, 703, 800605, 8911, 341, 293609485, 152551, 4371, 781, 10761055201, 41341321, 129921, 24211, 217, 5478598723585, 12283706701, 9224391, 4382191, 29341, 325, 713808066913201, 1064404682551, 2592053871, 381347461, 3405961, 58825, 65, 90614118359482705, 19142275066201, 201068525791, 9075517561, 557795161, 1611805, 15841, 91, 5993318051893040401, 31475449738947061, 15804698567581, 2459465259031, 333515107081, 299048101, 205465, 1729, 91]
)

say ":: Test passed!"
